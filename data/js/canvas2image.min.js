var Canvas2Image=function(){var t,n,o=(t=document.createElement("canvas"),{canvas:!!(n=t.getContext("2d")),imageData:!!n.getImageData,dataURL:!!t.toDataURL,btoa:!!window.btoa}),i="image/octet-stream";function u(t,n,e){var r=t.width,a=t.height;null==n&&(n=r),null==e&&(e=a);var o=document.createElement("canvas"),i=o.getContext("2d");return o.width=n,o.height=e,i.drawImage(t,0,0,r,a,0,0,n,e),o}function c(t,n,e,r){return(t=u(t,e,r)).toDataURL(n)}function g(t){document.location.href=t}function f(t){var n=document.createElement("img");return n.src=t,n}function m(t){return"image/"+(t=t.toLowerCase().replace(/jpg/i,"jpeg")).match(/png|jpeg|bmp|gif/)[0]}function h(t){if(!window.btoa)throw"btoa undefined";var n="";if("string"==typeof t)n=t;else for(var e=0;e<t.length;e++)n+=String.fromCharCode(t[e]);return btoa(n)}function v(t){var n=t.width,e=t.height;return t.getContext("2d").getImageData(0,0,n,e)}function d(t,n){return"data:"+n+";base64,"+t}function s(t){var n=t.width,e=t.height,r=[66,77,255&(r=54+(a=n*e*3)),r>>8&255,r>>16&255,r>>24&255,0,0,0,0,54,0,0,0],a=[40,0,0,0,255&n,n>>8&255,n>>16&255,n>>24&255,255&e,e>>8&255,e>>16&255,e>>24&255,1,0,24,0,0,0,0,0,255&a,a>>8&255,a>>16&255,a>>24&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=(4-3*n%4)%4,i=t.data,u="",c=n<<2,g=e,f=String.fromCharCode;do{for(var m=c*(g-1),v="",d=0;d<n;d++){var s=d<<2;v+=f(i[m+s+2])+f(i[m+s+1])+f(i[m+s])}for(var p=0;p<o;p++)v+=String.fromCharCode(0)}while(u+=v,--g);return h(r.concat(a))+h(u)}function r(t,n,e,r){var a;o.canvas&&o.dataURL&&("string"==typeof t&&(t=document.getElementById(t)),null==r&&(r="png"),r=m(r),/bmp/.test(r)?(a=v(u(t,n,e)),g(d(s(a),i))):g(c(t,r,n,e).replace(r,i)))}function a(t,n,e,r){if(o.canvas&&o.dataURL){if("string"==typeof t&&(t=document.getElementById(t)),null==r&&(r="png"),r=m(r),/bmp/.test(r)){var a=v(u(t,n,e));return f(d(s(a),"image/bmp"))}return f(c(t,r,n,e))}}return{saveAsImage:r,saveAsPNG:function(t,n,e){return r(t,n,e,"png")},saveAsJPEG:function(t,n,e){return r(t,n,e,"jpeg")},saveAsGIF:function(t,n,e){return r(t,n,e,"gif")},saveAsBMP:function(t,n,e){return r(t,n,e,"bmp")},convertToImage:a,convertToPNG:function(t,n,e){return a(t,n,e,"png")},convertToJPEG:function(t,n,e){return a(t,n,e,"jpeg")},convertToGIF:function(t,n,e){return a(t,n,e,"gif")},convertToBMP:function(t,n,e){return a(t,n,e,"bmp")}}}();